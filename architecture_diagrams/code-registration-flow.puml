@startuml FocusFortress-Registration-Code
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

LAYOUT_TOP_DOWN()

title Code Diagram - FocusFortress API Application - User Registration with Interests Selection

Container_Boundary(registration, "Registration Flow") {
    Component(user_controller, "UserController", "REST Controller", "POST /api/auth/register endpoint")
    Component(user_service, "UserService", "Service Class", "Orchestrates user registration")
    Component(interest_service, "InterestService", "Service Class", "Creates initial interests structure")
    Component(email_service, "EmailService", "Service Class", "Sends verification email")

    Component(user_repo, "UserRepository", "JpaRepository", "CRUD operations for User entity")
    Component(category_repo, "CategoryRepository", "JpaRepository", "CRUD operations for Category entity")
    Component(subcategory_repo, "SubcategoryRepository", "JpaRepository", "CRUD operations for Subcategory entity")
    Component(user_interest_repo, "UserInterestRepository", "JpaRepository", "CRUD operations for UserInterest entity")

    Component(interest_enum, "InterestCategory", "Enum", "Defines available interests with category/subcategory structure")
    Component(password_encoder, "PasswordEncoder", "BCryptPasswordEncoder", "Hashes passwords")
}

ContainerDb(db, "Database", "MySQL", "Stores users, categories, subcategories, user_interests")

Rel(user_controller, user_service, "Calls registerUser()", "Method call with UserRegistrationDTO")
Rel(user_service, password_encoder, "Encodes password", "encode(rawPassword)")
Rel(user_service, user_repo, "Saves user", "save(User)")
Rel(user_service, interest_service, "Creates interests", "createInitialInterestsForUser(user, selectedInterests)")
Rel(user_service, email_service, "Sends verification", "sendVerificationEmail(email, token)")

Rel(interest_service, interest_enum, "Reads structure from", "InterestCategory.values()")
Rel(interest_service, category_repo, "Finds/creates categories", "findByName() or save()")
Rel(interest_service, subcategory_repo, "Finds/creates subcategories", "findByNameAndCategoryId() or save()")
Rel(interest_service, user_interest_repo, "Creates user interests", "save(UserInterest)")

Rel(user_repo, db, "INSERT user", "JDBC")
Rel(category_repo, db, "SELECT/INSERT categories", "JDBC")
Rel(subcategory_repo, db, "SELECT/INSERT subcategories", "JDBC")
Rel(user_interest_repo, db, "INSERT user_interests", "JDBC")

@enduml